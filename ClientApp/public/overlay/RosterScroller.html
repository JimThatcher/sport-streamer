<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!-- meta name="viewport" content="width=1920 height=1080" -->
    <style type="text/css">
        body { 
            background-color: rgba(0, 0, 0, 0); 
            margin: 0px auto; 
            overflow: hidden;
        }
        body.hide {
            opacity: 0;
            transition-duration: 0.9s;
            transition-property: opacity;
        }
        body.show {
            opacity: 1;
            transition-duration: 0.8s;
            transition-property: opacity;
        }

        .scroll-container {
            max-width: 1920px;
            margin: 15px auto;
            overflow: visible;
            position: absolute; 
            top: 1002px; 
            left: 0px; 
            height: 62px;
            background: rgba(0, 0, 0, 0.5);
        }

        .scroll {
            display: flex;
            display: box;
            width: 100vw;
            overflow: hidden;
            margin: 5px auto;
        }

        .scroll-content {
            overflow: visible;
            animation: my-animation 50s linear infinite running;
            transform: translateX(100%);
            left: 0px; 
            width: 1920; 
            height: 62px;
            display: box;
            display: flex;
        }

        .scroll-text {
            /* animation properties */
            white-space: nowrap;
            font-size: 48px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            display: inline-flex;
            display: inline-box;
            transition: all 0.5s ease;
            margin-bottom: 5px;
        }

        /* for Chrome */
        @-webkit-keyframes my-animation {
            from { -webkit-transform: translateX(100%); }
            to { -webkit-transform: translateX(-100%); }
        }

        @keyframes my-animation {
            0% {
                -webkit-transform: translateX(100%);
                transform: translateX(0);
            }
            100% {
                -webkit-transform: translateX(-100%);
                transform: translateX(-50);
            }
        }
        

      </style>
</head>
<title>Roster Scroller</title>
<body>
    <div>
        <div style="position: absolute; top: 0px; left: 0px; width: 1920; height: 1080px;">
            <div class="scroll-container">
                <div class="scroll">
                    <div class="scroll-content">
                        <div class="scroll-text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        <div class="scroll-text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        <div class="scroll-text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        <div class="scroll-text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        <div class="scroll-text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        <div class="scroll-text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        <div class="scroll-text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        <div class="scroll-text" id="scroll-text1"></div>
                        <div class="scroll-text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        <div class="scroll-text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                        <!-- div class="scroll-text" id="scroll-text2">This is scrolling text.</div -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var rosterText = '';

        function showRoster() {
            document.body.classList.remove('hide');
            document.body.classList.add('show');
        }

        function hideRoster() {
            sponsorImgFile = '';
            document.body.classList.remove('show');
            document.body.classList.add('hide');
        };

        function parseQuery(queryString) {
            var query = {};
            var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&');
            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i].split('=');
                query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
            }
            return query;
        };

        function getRoster() {
            // Read the roster from database
            const queryStr = window.location.search;
            queryParms = parseQuery(queryStr);
            var teamToShow = (queryParms['team']) ? queryParms['team'] : 'Varsity';
            console.log(teamToShow);
            fetch('../rest/db/players/' + teamToShow)
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                // console.log(data);
                for (var i = 0; i < data.length; i++) {
                    rosterText += data[i].jersey + '-' + data[i].name + ' (' + data[i].position + '), ';
                }
                // Trim last comma from rosterText
                rosterText = rosterText.slice(0, -2);
                //rosterText = '                              ' + rosterText + '                       ';
                document.getElementById('scroll-text1').innerHTML = rosterText;
                // document.getElementById('scroll-text2').innerHTML = rosterText;
            })
            .catch(function (err) {
                console.log('error: ' + err);
            })
        };

        getRoster();

        if (!!window.EventSource) {
            var source = new EventSource('../events');
            source.addEventListener('open', function(e) {
                console.log("Events Connected");
            }, false);

            source.addEventListener('error', function(e) {
                if (e.target.readyState != EventSource.OPEN) {
                    console.log("Events Disconnected");
                }
            }, false);

            source.addEventListener('roster', function(e) {
                console.log("Show roster ", e.data);
                var data = JSON.parse(e.data);
                if (data.id == 0) {
                    hideRoster();
                } else {
                    showRoster();
                }
            }, false);
        }
    </script>
</body>
</html>